<!DOCTYPE html>
<html>
<head>
  <title>VA Task Generator</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f3f4f6;
      display: flex;
      justify-content: center;
      padding-top: 40px;
    }

    .app {
      background: white;
      padding: 25px;
      border-radius: 14px;
      width: 620px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
    }

    h2 {
      margin-bottom: 15px;
    }

    textarea {
      width: 100%;
      height: 90px;
      margin-bottom: 10px;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ddd;
      resize: none;
    }

    input, select {
      margin-bottom: 10px;
      width: 100%;
      padding: 8px;
      border-radius: 8px;
      border: 1px solid #ddd;
    }

    .controls {
      display: flex;
      gap: 8px;
      margin-bottom: 10px;
    }

    .controls button {
      flex: 1;
      padding: 10px;
      border-radius: 8px;
      border: none;
      background: #111;
      color: white;
      cursor: pointer;
      font-weight: bold;
    }

    .controls button:hover {
      opacity: 0.9;
    }

    li {
      margin: 10px 0;
      padding: 12px;
      background: #f9fafb;
      border-radius: 10px;
      display: grid;
      grid-template-columns: 40px 40px 1fr 110px 80px;
      align-items: center;
      gap: 10px;
      transition: all 0.2s ease;
    }

    li:hover {
      transform: scale(1.01);
      background: #f3f4f6;
    }

    .task-number {
      font-weight: bold;
      color: #555;
    }

    .task-text {
      font-size: 14px;
    }

    .completed .task-text {
      text-decoration: line-through;
      opacity: 0.4;
    }

    .task-actions {
      display: flex;
      gap: 6px;
    }

    .task-actions button {
      border: none;
      background: transparent;
      cursor: pointer;
      font-size: 16px;
    }

    .high { border-left: 4px solid red; }
    .normal { border-left: 4px solid orange; }
    .low { border-left: 4px solid green; }

    #stats {
      margin: 10px 0;
      font-size: 14px;
      font-weight: bold;
    }

  </style>
</head>

<body>
  <div class="app">
    <h2>VA Task Generator</h2>

    <select id="clientSelect" onchange="switchClient()">
      <option>Clayton</option>
      <option>Deanne</option>
    </select>

    <div id="stats"></div>

    <input id="search" placeholder="Search tasks..." oninput="renderTasks()" />

    <select id="filter" onchange="renderTasks()">
      <option value="all">All Tasks</option>
      <option value="pending">Pending</option>
      <option value="completed">Completed</option>
      <option value="high">High Priority</option>
    </select>

    <textarea id="transcription" placeholder="Paste tasks here..."></textarea>

    <div class="controls">
      <button onclick="generateTasks()">Generate</button>
      <button onclick="clearCompleted()">Clear</button>
      <button onclick="copyTasks()">Copy</button>
      <button onclick="downloadCSV()">CSV</button>
    </div>

    <ol id="taskList"></ol>
  </div>

  <script>
    let client = localStorage.getItem("va_client") || "Clayton";
    document.getElementById("clientSelect").value = client;

    function getStorageKey() {
      return "va_tasks_" + client;
    }

    let tasks = JSON.parse(localStorage.getItem(getStorageKey())) || [];

    function saveTasks() {
      localStorage.setItem(getStorageKey(), JSON.stringify(tasks));
    }

    function getNextNumber() {
      if (!tasks.length) return 1;
      return Math.max(...tasks.map(t => t.number)) + 1;
    }

    function switchClient() {
      client = document.getElementById("clientSelect").value;
      localStorage.setItem("va_client", client);
      tasks = JSON.parse(localStorage.getItem(getStorageKey())) || [];
      renderTasks();
    }

    function renderStats() {
      const total = tasks.length;
      const completed = tasks.filter(t => t.completed).length;
      const pending = total - completed;

      document.getElementById("stats").innerHTML =
        `Total: ${total} | Pending: ${pending} | Completed: ${completed}`;
    }

    function renderTasks() {
      renderStats();

      const list = document.getElementById("taskList");
      const search = document.getElementById("search").value.toLowerCase();
      const filter = document.getElementById("filter").value;

      list.innerHTML = "";

      tasks
        .sort((a, b) => a.number - b.number)
        .forEach((task, index) => {

          if (search && !task.text.toLowerCase().includes(search)) return;
          if (filter === "pending" && task.completed) return;
          if (filter === "completed" && !task.completed) return;
          if (filter === "high" && task.priority !== "High") return;

          const li = document.createElement("li");
          li.className = `${task.completed ? "completed" : ""} ${task.priority.toLowerCase()}`;

          li.innerHTML = `
            <div class="task-number">${task.number}.</div>

            <input type="checkbox" ${task.completed ? "checked" : ""}
              onchange="toggleTask(${index})" />

            <div class="task-text">${task.text}</div>

            <select onchange="setPriority(${index}, this.value)">
              <option ${task.priority==="High"?"selected":""}>High</option>
              <option ${task.priority==="Normal"?"selected":""}>Normal</option>
              <option ${task.priority==="Low"?"selected":""}>Low</option>
            </select>

            <div class="task-actions">
              <button onclick="editTask(${index})">✏️</button>
              <button onclick="deleteTask(${index})">❌</button>
            </div>
          `;

          list.appendChild(li);
        });
    }

    function generateTasks() {
      const text = document.getElementById("transcription").value;
      if (!text.trim()) return;

      const lines = text.split(/\r?\n/);
      let nextNumber = getNextNumber();

      lines.forEach(line => {
        const cleaned = line.trim();
        if (!cleaned) return;

        if (tasks.some(t => t.text === cleaned)) return;

        tasks.push({
          number: nextNumber++,
          text: cleaned,
          completed: false,
          priority: "Normal"
        });
      });

      document.getElementById("transcription").value = "";

      saveTasks();
      renderTasks();
    }

    function toggleTask(index) {
      tasks[index].completed = !tasks[index].completed;
      saveTasks();
      renderTasks();
    }

    function deleteTask(index) {
      tasks.splice(index, 1);
      saveTasks();
      renderTasks();
    }

    function editTask(index) {
      const newText = prompt("Edit task:", tasks[index].text);
      if (!newText) return;

      tasks[index].text = newText;
      saveTasks();
      renderTasks();
    }

    function setPriority(index, value) {
      tasks[index].priority = value;
      saveTasks();
      renderTasks();
    }

    function clearCompleted() {
      tasks = tasks.filter(t => !t.completed);
      saveTasks();
      renderTasks();
    }

    function copyTasks() {
      const text = tasks.map(t => `${t.number}. ${t.text}`).join("\n");
      navigator.clipboard.writeText(text);
      alert("Tasks copied!");
    }

    function downloadCSV() {
      let csv = "Number,Task,Priority,Completed\n";
      tasks.forEach(t => {
        csv += `${t.number},"${t.text}",${t.priority},${t.completed}\n`;
      });

      const blob = new Blob([csv], { type: "text/csv" });
      const url = URL.createObjectURL(blob);

      const a = document.createElement("a");
      a.href = url;
      a.download = "tasks.csv";
      a.click();
    }

    renderTasks();
  </script>
</body>
</html>
